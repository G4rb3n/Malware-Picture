![DarkUniverse原理图](https://github.com/G4rb3n/Malware-Picture/blob/master/APT/DarkUniverse/DarkUniverse1.png)

![DarkUniverse原理图](https://github.com/G4rb3n/Malware-Picture/blob/master/APT/DarkUniverse/DarkUniverse2.png)

```
1. 通过鱼叉式钓鱼传播恶意软件，钓鱼邮件附件会释放两个恶意文件，updater.mod 和 glue30.dll。

2. 然后它将合法的rundll32.exe 可执行文件复制到相同的目录中并借此运行updater.mod。

3. Updater.mod 模块为病毒母体，是个 DLL，其中只含有一个导出函数 callme@16，该模块负责提供和 C&C 服务器的通信。

4. dfrgntfs5.sqt –用于执行 C2 命令的模块；msvcrt58.sqt –用于窃取邮件凭证和邮件的模块；zl4vq.sqt – dfrgntfs5 使用的合法 zlib 库。%victim_ID%.upe – dfrgntfs5 的可选插件。遗憾的是我们无法获取该文件。

5. Updater.mod 模块使用 Win API 函数 SetWindowsHookExW 为键盘安装 hook 并将 glue30.dll 注入得到键盘输入的进程中。之后，glue30.dll 在每个被 hook 进程的上下文中加载并开始拦截输入。

6. Msvcrt58.sqt 模块拦截未加密的 POP3 流量以收集邮件会话和受害者的凭证。该模块从以下进程中查找流量：

	outlook.exe
	winmail.exe
	msimn.exe
	nlnotes.exe
	eudora.exe
	thunderbird.exe
	thunde~1.exe
	msmsgs.exe
	msnmsgr.exe