![MuddyWater攻击流程图](https://github.com/G4rb3n/Malware-Picture/blob/master/APT/Irania/MuddyWater/MuddyWater.png)
```
1. 攻击目标为巴基斯坦和土耳其等中东国家。

2. 攻击方式为钓鱼邮件或捆绑软件，钓鱼邮件内容会诱导用户启动宏。

3. 释放 Defender.sct、WindowsDefender.ini、ProjectConfManagerNT.ini 等加密 payload。

4. 调用 Excel.Appilcation->DDEInitiate Method、 Outlook.Application、 DCOM 执行 powershell 代码。

5. powershell 系 Powerstats 和 PRB-Backdoor 的变种。

6. powershell 代码使用如 $enV:ComSpEc[4,24,25]-jOiN'' 之类的命令混淆 iex，使用随机字符串替换变量。

7. powershell 代码具有反调试功能，当检测到有 cmd.exe、PowerShell.exe、Powershell_ISE.exe 进程，则使用 [Invoke-BSOD.ps1](https://github.com/peewpw/Invoke-BSOD/blob/master/Invoke-BSOD.ps1) 触发蓝屏。

8. powershell 代码收集以下主机信息：

   -- 网络适配器配置的IP地址
   -- 操作系统名称
   -- 操作系统的架构
   -- 计算机名
   -- 计算机域名
   -- 用户名

9. powershell 代码执行以下后门指令：

   -- reboot			使用关机命令重新启动系统
   -- shutdown			使用关机命令关闭系统
   -- clean				删除驱动盘，C:\，D:\，E:\，F:\
   -- screenshot 	 	截取屏幕 
   -- excel 	 	 	使用 excel DCOM 加载 powershell 脚本执行 
   -- outlook 	 		使用 outlook DCOM 加载 powershell 脚本执行 
   -- risk 	 	 		使用 "9BA05972-F6A8-11CF-A442-00A0C90A8F39" 对应的 DCOM 加载 powershell 执行 
   -- upload 	 	 	将截取的截屏图像上传到服务器
   -- 默认 	 			加载服务器指定的 powershell 命令 

```